{"version":3,"file":"DeprecatedExpoGLObjectTextureLoader.js","names":["neverEnding","Promise","available","NativeModulesProxy","ExponentGLObjectManager","createObjectAsync","warned","ExpoGLObjectTextureLoader","WebGLTextureLoaderAsyncHashCache","WeakMap","canLoad","input","console","log","disposeTexture","texture","exglObjId","objIds","get","destroyObjectAsync","delete","inputHash","config","JSON","stringify","loadNoCache","gl","__exglCtxId","exglCtxId","disposed","dispose","promise","then","WebGLTexture","set","width","height","globalRegistry","add"],"sources":["../src/DeprecatedExpoGLObjectTextureLoader.js"],"sourcesContent":["//@flow\nimport {\n  globalRegistry,\n  WebGLTextureLoaderAsyncHashCache\n} from \"webgltexture-loader\";\nimport { NativeModulesProxy } from \"expo-modules-core\";\n\nconst neverEnding = new Promise(() => { });\n\nconst available = !!(\n  NativeModulesProxy.ExponentGLObjectManager &&\n  NativeModulesProxy.ExponentGLObjectManager.createObjectAsync\n);\n\nlet warned = false;\n\nclass ExpoGLObjectTextureLoader extends WebGLTextureLoaderAsyncHashCache<Object> {\n  static priority = -200;\n\n  objIds: WeakMap<WebGLTexture, number> = new WeakMap();\n\n  canLoad(input: any) {\n    if (!available && !warned) {\n      warned = true;\n      console.log(\n        \"webgltexture-loader-expo: ExponentGLObjectManager.createObjectAsync is not available. Make sure to use the correct version of Expo\"\n      );\n    }\n    return available && typeof input === \"object\";\n  }\n\n  disposeTexture(texture: WebGLTexture) {\n    const exglObjId = this.objIds.get(texture);\n    if (exglObjId) {\n      NativeModulesProxy.ExponentGLObjectManager.destroyObjectAsync(exglObjId);\n    }\n    this.objIds.delete(texture);\n  }\n\n  inputHash(config: Object) {\n    // JSON.stringify is a quick way to hash the config object\n    return JSON.stringify(config);\n  }\n\n  loadNoCache(config: Object) {\n    const { gl } = this;\n    // $FlowFixMe\n    const { __exglCtxId: exglCtxId } = gl;\n    let disposed = false;\n    const dispose = () => {\n      disposed = true;\n    };\n    const promise = NativeModulesProxy.ExponentGLObjectManager.createObjectAsync(\n      {\n        exglCtxId,\n        texture: config\n      }\n    ).then(({ exglObjId }) => {\n      if (disposed) return neverEnding;\n      // $FlowFixMe\n      const texture = new WebGLTexture(exglObjId);\n      this.objIds.set(texture, exglObjId);\n      const width = 0;\n      const height = 0;\n      // ^ unfortunately there is no way to retrieve these\n      return { texture, width, height };\n    });\n    return { promise, dispose };\n  }\n}\n\nglobalRegistry.add(ExpoGLObjectTextureLoader);\n\nexport default ExpoGLObjectTextureLoader;\n"],"mappings":";;;;;;;AACA;;AAIA;;;;AAEA,MAAMA,WAAW,GAAG,IAAIC,OAAJ,CAAY,MAAM,CAAG,CAArB,CAApB;AAEA,MAAMC,SAAS,GAAG,CAAC,EACjBC,mCAAA,CAAmBC,uBAAnB,IACAD,mCAAA,CAAmBC,uBAAnB,CAA2CC,iBAF1B,CAAnB;AAKA,IAAIC,MAAM,GAAG,KAAb;;AAEA,MAAMC,yBAAN,SAAwCC,oDAAxC,CAAiF;EAAA;IAAA;;IAAA,gCAGvC,IAAIC,OAAJ,EAHuC;EAAA;;EAK/EC,OAAO,CAACC,KAAD,EAAa;IAClB,IAAI,CAACT,SAAD,IAAc,CAACI,MAAnB,EAA2B;MACzBA,MAAM,GAAG,IAAT;MACAM,OAAO,CAACC,GAAR,CACE,oIADF;IAGD;;IACD,OAAOX,SAAS,IAAI,OAAOS,KAAP,KAAiB,QAArC;EACD;;EAEDG,cAAc,CAACC,OAAD,EAAwB;IACpC,MAAMC,SAAS,GAAG,KAAKC,MAAL,CAAYC,GAAZ,CAAgBH,OAAhB,CAAlB;;IACA,IAAIC,SAAJ,EAAe;MACbb,mCAAA,CAAmBC,uBAAnB,CAA2Ce,kBAA3C,CAA8DH,SAA9D;IACD;;IACD,KAAKC,MAAL,CAAYG,MAAZ,CAAmBL,OAAnB;EACD;;EAEDM,SAAS,CAACC,MAAD,EAAiB;IACxB;IACA,OAAOC,IAAI,CAACC,SAAL,CAAeF,MAAf,CAAP;EACD;;EAEDG,WAAW,CAACH,MAAD,EAAiB;IAC1B,MAAM;MAAEI;IAAF,IAAS,IAAf,CAD0B,CAE1B;;IACA,MAAM;MAAEC,WAAW,EAAEC;IAAf,IAA6BF,EAAnC;IACA,IAAIG,QAAQ,GAAG,KAAf;;IACA,MAAMC,OAAO,GAAG,MAAM;MACpBD,QAAQ,GAAG,IAAX;IACD,CAFD;;IAGA,MAAME,OAAO,GAAG5B,mCAAA,CAAmBC,uBAAnB,CAA2CC,iBAA3C,CACd;MACEuB,SADF;MAEEb,OAAO,EAAEO;IAFX,CADc,EAKdU,IALc,CAKT,CAAC;MAAEhB;IAAF,CAAD,KAAmB;MACxB,IAAIa,QAAJ,EAAc,OAAO7B,WAAP,CADU,CAExB;;MACA,MAAMe,OAAO,GAAG,IAAIkB,YAAJ,CAAiBjB,SAAjB,CAAhB;MACA,KAAKC,MAAL,CAAYiB,GAAZ,CAAgBnB,OAAhB,EAAyBC,SAAzB;MACA,MAAMmB,KAAK,GAAG,CAAd;MACA,MAAMC,MAAM,GAAG,CAAf,CANwB,CAOxB;;MACA,OAAO;QAAErB,OAAF;QAAWoB,KAAX;QAAkBC;MAAlB,CAAP;IACD,CAde,CAAhB;;IAeA,OAAO;MAAEL,OAAF;MAAWD;IAAX,CAAP;EACD;;AApD8E;;gBAA3EvB,yB,cACc,CAAC,G;;AAsDrB8B,kCAAA,CAAeC,GAAf,CAAmB/B,yBAAnB;;eAEeA,yB"}