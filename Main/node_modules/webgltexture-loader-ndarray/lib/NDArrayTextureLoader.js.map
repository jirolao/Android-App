{"version":3,"file":"NDArrayTextureLoader.js","names":["NDArrayTextureLoader","WebGLTextureLoaderSyncHashCache","constructor","gl","floatSupported","getExtension","canLoad","obj","shape","data","stride","inputHash","input","getNoCache","texture","createTexture","bindTexture","TEXTURE_2D","width","height","drawNDArrayTexture","update","get","globalRegistry","add"],"sources":["../src/NDArrayTextureLoader.js"],"sourcesContent":["//@flow\nimport {\n  WebGLTextureLoaderSyncHashCache,\n  globalRegistry,\n} from \"webgltexture-loader\";\nimport type { NDArray } from \"ndarray\";\nimport drawNDArrayTexture from \"./drawNDArrayTexture\";\n\nclass NDArrayTextureLoader extends WebGLTextureLoaderSyncHashCache<NDArray> {\n  floatSupported: boolean;\n  constructor(gl: *) {\n    super(gl);\n    this.floatSupported = gl.getExtension(\"OES_texture_float_linear\");\n  }\n\n  canLoad(obj: any) {\n    return obj.shape && obj.data && obj.stride;\n  }\n\n  inputHash(input: NDArray) {\n    return input;\n  }\n\n  getNoCache(input: NDArray) {\n    const { gl } = this;\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    const [width, height] = input.shape;\n    drawNDArrayTexture(gl, texture, input, this.floatSupported);\n    return { texture, width, height };\n  }\n\n  update(input: NDArray) {\n    // For now we assume the NDArray always change & need a redraw but we might try to only update if changes later\n    const { gl } = this;\n    const { texture } = this.get(input);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    drawNDArrayTexture(gl, texture, input, this.floatSupported);\n  }\n}\n\nglobalRegistry.add(NDArrayTextureLoader);\n\nexport default NDArrayTextureLoader;\n"],"mappings":";;;;;;;AACA;;AAKA;;;;;;AAEA,MAAMA,oBAAN,SAAmCC,mDAAnC,CAA4E;EAE1EC,WAAW,CAACC,EAAD,EAAQ;IACjB,MAAMA,EAAN;;IADiB;;IAEjB,KAAKC,cAAL,GAAsBD,EAAE,CAACE,YAAH,CAAgB,0BAAhB,CAAtB;EACD;;EAEDC,OAAO,CAACC,GAAD,EAAW;IAChB,OAAOA,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACE,IAAjB,IAAyBF,GAAG,CAACG,MAApC;EACD;;EAEDC,SAAS,CAACC,KAAD,EAAiB;IACxB,OAAOA,KAAP;EACD;;EAEDC,UAAU,CAACD,KAAD,EAAiB;IACzB,MAAM;MAAET;IAAF,IAAS,IAAf;IACA,MAAMW,OAAO,GAAGX,EAAE,CAACY,aAAH,EAAhB;IACAZ,EAAE,CAACa,WAAH,CAAeb,EAAE,CAACc,UAAlB,EAA8BH,OAA9B;IACA,MAAM,CAACI,KAAD,EAAQC,MAAR,IAAkBP,KAAK,CAACJ,KAA9B;IACA,IAAAY,2BAAA,EAAmBjB,EAAnB,EAAuBW,OAAvB,EAAgCF,KAAhC,EAAuC,KAAKR,cAA5C;IACA,OAAO;MAAEU,OAAF;MAAWI,KAAX;MAAkBC;IAAlB,CAAP;EACD;;EAEDE,MAAM,CAACT,KAAD,EAAiB;IACrB;IACA,MAAM;MAAET;IAAF,IAAS,IAAf;IACA,MAAM;MAAEW;IAAF,IAAc,KAAKQ,GAAL,CAASV,KAAT,CAApB;IACAT,EAAE,CAACa,WAAH,CAAeb,EAAE,CAACc,UAAlB,EAA8BH,OAA9B;IACA,IAAAM,2BAAA,EAAmBjB,EAAnB,EAAuBW,OAAvB,EAAgCF,KAAhC,EAAuC,KAAKR,cAA5C;EACD;;AA9ByE;;AAiC5EmB,kCAAA,CAAeC,GAAf,CAAmBxB,oBAAnB;;eAEeA,oB"}